<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test des Corrections de Troph√©es</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .test-section h3 {
            margin-top: 0;
            color: #333;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 15px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
        }
        button:hover {
            background: #0056b3;
        }
        .result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 5px;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üèÜ Test des Corrections de Troph√©es</h1>
        <p>Ce test v√©rifie que les corrections pour <strong>minigame_master</strong> et <strong>photo_enthusiast</strong> fonctionnent correctement.</p>
        
        <div class="test-section">
            <h3>üéÆ Test Minigame Master</h3>
            <p>Simule la completion des 3 mini-jeux avec la correction <code>result.gameType</code></p>
            <button onclick="testMinigameMaster()">Tester Minigame Master</button>
            <div id="minigame-result"></div>
        </div>
        
        <div class="test-section">
            <h3>üì∏ Test Photo Enthusiast</h3>
            <p>Simule l'ajout de photos et v√©rifie la condition</p>
            <button onclick="testPhotoEnthusiast()">Tester Photo Enthusiast</button>
            <button onclick="addTestPhoto()">Ajouter une Photo Test</button>
            <button onclick="clearTestPhotos()">Effacer Photos Test</button>
            <div id="photo-result"></div>
        </div>
        
        <div class="test-section">
            <h3>üìä √âtat Actuel</h3>
            <button onclick="checkCurrentState()">V√©rifier √âtat Actuel</button>
            <div id="current-state"></div>
        </div>
    </div>

    <script>
        const testPlayer = { name: 'TestPlayer' };
        
        // Condition corrig√©e pour minigame_master
        function checkMinigameMaster(player, minigameResults = []) {
            const gameTypes = ["morse", "tentacle", "sharing"];
            return gameTypes.every((type) =>
                minigameResults.some(
                    (result) => result.gameType === type && result.success && !result.skipped
                )
            );
        }
        
        // Condition pour photo_enthusiast
        function checkPhotoEnthusiast(player) {
            if (!player?.name) return false;
            const photos = JSON.parse(
                localStorage.getItem(`photos_${player.name}`) || "[]"
            );
            return photos.length >= 3;
        }
        
        function testMinigameMaster() {
            const resultDiv = document.getElementById('minigame-result');
            
            // Test avec l'ancienne structure (result.type) - devrait √©chouer
            const oldResults = [
                { type: 'morse', success: true, skipped: false },
                { type: 'tentacle', success: true, skipped: false },
                { type: 'sharing', success: true, skipped: false }
            ];
            
            // Test avec la nouvelle structure (result.gameType) - devrait r√©ussir
            const newResults = [
                { gameType: 'morse', success: true, skipped: false },
                { gameType: 'tentacle', success: true, skipped: false },
                { gameType: 'sharing', success: true, skipped: false }
            ];
            
            const oldCheck = checkMinigameMaster(testPlayer, oldResults);
            const newCheck = checkMinigameMaster(testPlayer, newResults);
            
            resultDiv.innerHTML = `
                <div class="result ${oldCheck ? 'error' : 'success'}">
                    ‚ùå Ancienne structure (result.type): ${oldCheck ? 'R√âUSSI (probl√®me!)' : '√âCHOU√â (correct)'}
                </div>
                <div class="result ${newCheck ? 'success' : 'error'}">
                    ‚úÖ Nouvelle structure (result.gameType): ${newCheck ? 'R√âUSSI (correct!)' : '√âCHOU√â (probl√®me)'}
                </div>
                <div class="result info">
                    üîß Correction appliqu√©e: La condition utilise maintenant <code>result.gameType</code> au lieu de <code>result.type</code>
                </div>
            `;
        }
        
        function testPhotoEnthusiast() {
            const resultDiv = document.getElementById('photo-result');
            const photos = JSON.parse(localStorage.getItem(`photos_${testPlayer.name}`) || '[]');
            const isUnlocked = checkPhotoEnthusiast(testPlayer);
            
            resultDiv.innerHTML = `
                <div class="result info">
                    üì∏ Photos actuelles: ${photos.length}
                </div>
                <div class="result ${isUnlocked ? 'success' : 'error'}">
                    üèÜ Troph√©e Photo Enthusiast: ${isUnlocked ? 'D√âBLOQU√â' : 'VERROUILL√â'} (requis: 3 photos)
                </div>
            `;
        }
        
        function addTestPhoto() {
            const photos = JSON.parse(localStorage.getItem(`photos_${testPlayer.name}`) || '[]');
            const newPhoto = {
                id: `test_photo_${Date.now()}`,
                timestamp: Date.now(),
                enigmaId: 'test_enigma',
                playerName: testPlayer.name
            };
            photos.push(newPhoto);
            localStorage.setItem(`photos_${testPlayer.name}`, JSON.stringify(photos));
            
            testPhotoEnthusiast();
        }
        
        function clearTestPhotos() {
            localStorage.removeItem(`photos_${testPlayer.name}`);
            testPhotoEnthusiast();
        }
        
        function checkCurrentState() {
            const resultDiv = document.getElementById('current-state');
            
            // V√©rifier toutes les cl√©s de photos
            const photoKeys = Object.keys(localStorage).filter(key => key.startsWith('photos_'));
            
            // V√©rifier toutes les cl√©s de mini-jeux
            const minigameKeys = Object.keys(localStorage).filter(key => key.startsWith('minigameResults_'));
            
            let html = '<div class="result info"><h4>üìä √âtat du localStorage:</h4>';
            
            if (photoKeys.length > 0) {
                html += '<h5>üì∏ Photos par joueur:</h5>';
                photoKeys.forEach(key => {
                    const playerName = key.replace('photos_', '');
                    const photos = JSON.parse(localStorage.getItem(key) || '[]');
                    html += `<p>‚Ä¢ ${playerName}: ${photos.length} photos</p>`;
                });
            } else {
                html += '<p>Aucune photo trouv√©e</p>';
            }
            
            if (minigameKeys.length > 0) {
                html += '<h5>üéÆ R√©sultats mini-jeux par joueur:</h5>';
                minigameKeys.forEach(key => {
                    const playerName = key.replace('minigameResults_', '');
                    const results = JSON.parse(localStorage.getItem(key) || '[]');
                    html += `<p>‚Ä¢ ${playerName}: ${results.length} r√©sultats</p>`;
                    results.forEach(result => {
                        html += `  - ${result.gameType || result.type}: ${result.success ? 'R√©ussi' : '√âchou√©'}</p>`;
                    });
                });
            } else {
                html += '<p>Aucun r√©sultat de mini-jeu trouv√©</p>';
            }
            
            html += '</div>';
            resultDiv.innerHTML = html;
        }
        
        // Test initial
        window.onload = function() {
            checkCurrentState();
        };
    </script>
</body>
</html>